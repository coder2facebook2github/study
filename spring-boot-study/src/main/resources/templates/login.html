<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/header::header"></head>
<body class="text-center">
<!--<nav th:replace="common/nav :: nav"></nav>-->
<link th:href="@{/css/login.css}" rel="stylesheet" type="text/css"/>
<link th:href="@{/css/easyform.css}" rel="stylesheet" type="text/css"/>
<script th:src="@{/js/easyform.js}" type="text/javascript" ></script>
<form class="form-signin" id="login-form">
    <img class="mb-4" src="https://sites.image.biyoshop.com/newerp/201804/3ac2a7848a2a38a1e0dcce5f2a02c8ca_20180430.jpg"
         alt="" width="72" height="72">
    <h1 class="h3 mb-3 font-weight-normal">Please sign in</h1>
    <label for="mobile" class="sr-only">mobile</label>
    <input type="tel" id="mobile" name="username" class="form-control" placeholder="手机号"
           data-easyform="number;" data-message="请填写手机号">
    <label for="password" class="sr-only">Password</label>
    <input type="password" id="password" class="form-control" placeholder="密码"
           data-easyform="char-normal;" data-message="请填写密码">
    <input type="hidden" th:value="${token}" name="token" id="token">

    <div class="form-row">
        <div class="col">
            <input type="text" class="form-control" name="code" id="code" placeholder="验证码"
                   data-easyform="number;" data-message="请填写验证码"/>
        </div>
        <div class="col">
            <img class="random-image" th:attr="src=${randomImageUrl}" style="cursor:pointer"
                 id="randomImage" title="点击刷新" onclick="changeCode();"/>
        </div>
    </div>

    <div class="checkbox mb-3 remember">
        <label>
            <input type="checkbox" value="1"> Remember me
        </label>
    </div>
    <span class="btn btn-lg btn-primary btn-block" onclick="submitForm()">Sign in</span>
    <p class="mt-5 mb-3 text-muted">&copy; 2017-2018</p>
</form>
<script type="text/javascript">

    $(function () {
    });

    function changeCode() {
        var randomImage = $("#randomImage");
        randomImage.attr("src", randomImage.attr("src") + "&random=" + new Date().getTime());
    }



    function submitForm() {
        var ef = $('#login-form').easyform();
        ef.is_submit = false;
        ef.success=  function() {
            var formObject = {};
            formObject.username = $("#mobile").val();
            formObject.password = $("#password").val();
            formObject.token = $("#token").val();
            formObject.code = $("#code").val();
            alert(JSON.stringify(formObject));
            $.ajax({
                type: 'post',
                url: '/login',
                async: false,
                contentType: 'application/json',
                data: JSON.stringify(formObject),
                dataType: 'json',
                success: function (result) {
                    if (result.message == "success") {
                        alert("success");
                    } else {
                        alert(result.message);
                    }
                },
                error: function() {
                    alert("服务异常");
                }
            });
        }
    }
</script>
</body>
</html>